
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Storyboard</title>
  <link rel="stylesheet" href="storyboard.css" />
</head>
<body>
  <h2>Story Scene: The Tortoise and The Hare</h2>

  <div class="scene-wrapper">
    <img src="images/colored-background2.png" id="scene" alt="Scene">
    <!-- We’ll insert ONE character element from JS below -->
  </div>

  <script type="module">
    import { colorCharacterFrames } from './js/color-map-advanced.js';

    const masked = localStorage.getItem('coloredCharacter');       // PNG from canvas step (masked inside-lines)
    const char   = (localStorage.getItem('selectedCharacter') || '').toLowerCase();

    if (!char) {
      alert('No character selected yet.');
    } else {
      // Create a single node for the chosen character, positioned by CSS class
      const node = document.createElement('img');
      node.className = `character ${char}`;
      node.alt = char;
      node.draggable = false;
      // start with outline so something is visible immediately
      node.src = `images/outline/${char}-transparent.png`;
      document.querySelector('.scene-wrapper').appendChild(node);

      // If we have a masked color layer, build the 4 frames and animate
      if (masked) {
        try {
          const frames = await colorCharacterFrames({
            character: char,
            maskedBaseDataURL: masked
          });

          let i = 0;
          node.src = frames[0].dataURL; // first frame immediately
          setInterval(() => {
            node.src = frames[i].dataURL;
            i = (i + 1) % frames.length;
          }, 250); // ~4fps
        } catch (err) {
          console.error('Colorized frames failed; keeping outline:', err);
        }
      }
    }

    // Optional: clear local items so refresh doesn’t duplicate
    // localStorage.removeItem('coloredCharacter');
    // localStorage.removeItem('selectedCharacter');
  </script>
</body>
</html>
