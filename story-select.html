
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Select a Story</title>
  <style>
    :root{ --card-r:12px; --accent:#BADA55; }
    body{margin:0;font-family:system-ui,Arial;background:#eff4ff}
    header{padding:20px 16px;text-align:center}
    h1{margin:0 0 6px;font-size:clamp(22px,4vw,36px)}
    #sessionInfo{opacity:.7}

    .grid{
      display:grid;
      grid-template-columns:repeat(4,minmax(220px,1fr));
      gap:16px;
      padding:20px;
      max-width:1100px;
      margin:0 auto 40px;
    }
    .card{
      position:relative;
      background:#fff;
      border-radius:var(--card-r);
      box-shadow:0 4px 10px rgba(0,0,0,.06);
      overflow:hidden;
      border:2px solid transparent;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      min-height:220px;
      transition:border-color .15s ease, transform .15s ease;
    }
    .card:hover{ border-color:var(--accent); transform:translateY(-1px); }
    .thumb{
      position:relative;
      aspect-ratio:4/3;
      background:#dfe7ff;
      display:flex; align-items:center; justify-content:center;
      color:#445; font-size:18px;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block }
    .title{ padding:12px 14px; font-weight:600; background:#fff }

    /* Coming soon / disabled */
    .card.disabled{ cursor:default; filter:grayscale(100%) opacity(.65); border-color:#e5e8f4 }
    .card.disabled:hover{ border-color:#e5e8f4; transform:none }
    .card.disabled .thumb::after{
      content:"COMING SOON";
      position:absolute; inset:0;
      background:rgba(0,0,0,.35);
      color:#fff; display:flex; align-items:center; justify-content:center;
      font-weight:800; letter-spacing:.06em;
      text-shadow:0 1px 2px rgba(0,0,0,.35);
    }

    .ph{ width:100%; height:100%; display:flex; align-items:center; justify-content:center;
         color:#667; font-size:16px; padding:10px; text-align:center }

    @media (max-width:980px){ .grid{ grid-template-columns:repeat(3,minmax(220px,1fr)) } }
    @media (max-width:720px){ .grid{ grid-template-columns:repeat(2,minmax(220px,1fr)) } }
    @media (max-width:480px){ .grid{ grid-template-columns:1fr } }
  </style>
</head>
<body>
  <header>
    <h1>Pick Your Story</h1>
    <div id="sessionInfo"></div>
  </header>

  <div class="grid" id="storyGrid" aria-live="polite"></div>

  <script type="module">
    import { readCtx, nextURL } from './js/flow.js';

    // Route guard: require a session before picking stories
    const ctx = readCtx();
    if (!ctx.session) { location.replace('index.html'); throw 0; }
    document.getElementById('sessionInfo').textContent = `Session: ${ctx.session}`;

    // Stories (ids match /stories/<id>/slides.json and /stories/<id>/characters.json)
    const STORIES = [
      { id:'tortoise-hare', name:'The Tortoise and the Hare', thumb:'images/story-thumbnails/tortoise-hare-thumb.png', ready:true },
      { id:'lion-mouse',    name:'The Lion and the Mouse',    thumb:'images/story-thumbnails/lion-mouse-thumb.png',   ready:true },

      { id:'story-3',  name:'Story 3',  thumb:'', ready:false },
      { id:'story-4',  name:'Story 4',  thumb:'', ready:false },
      { id:'story-5',  name:'Story 5',  thumb:'', ready:false },
      { id:'story-6',  name:'Story 6',  thumb:'', ready:false },
      { id:'story-7',  name:'Story 7',  thumb:'', ready:false },
      { id:'story-8',  name:'Story 8',  thumb:'', ready:false },
      { id:'story-9',  name:'Story 9',  thumb:'', ready:false },
      { id:'story-10', name:'Story 10', thumb:'', ready:false },
      { id:'story-11', name:'Story 11', thumb:'', ready:false },
      { id:'story-12', name:'Story 12', thumb:'', ready:false }
    ];

    const grid = document.getElementById('storyGrid');

    function thumbHTML(s){
      if (!s.thumb) return `<div class="ph">${s.name}</div>`;
      // Fallback to title block if thumbnail is missing/broken
      return `<img src="${s.thumb}" alt="${s.name}"
                 onerror="this.replaceWith(Object.assign(document.createElement('div'),{className:'ph',textContent:'${s.name}'}))">`;
    }

    for (const s of STORIES) {
      const card = document.createElement('div');
      card.className = 'card' + (s.ready ? '' : ' disabled');
      card.setAttribute('role','button');
      card.setAttribute('aria-label', s.name + (s.ready ? '' : ' (coming soon)'));
      card.innerHTML = `
        <div class="thumb">${thumbHTML(s)}</div>
        <div class="title">${s.name}</div>
      `;
      if (s.ready) {
        card.addEventListener('click', () => {
          localStorage.setItem('selectedStory', s.id);
          location.href = nextURL('grade-select.html', { ...ctx, story:s.id });
        });
      }
      grid.appendChild(card);
    }
  </script>
</body>
</html>
