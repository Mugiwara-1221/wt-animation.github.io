
<!--character-select-->
<!DOCTYPE html>
<html>
<head>
  <title>Character Selection</title>
  <link rel="stylesheet" href="sprite-style.css">
</head>
<body>
  <h2>Select your Character!</h2>
  <div class="scene-wrapper">
    <!-- Background Scene -->
    <img src="images/colored-background2.png" id="scene" alt="Scene">

    <!-- Overlay Character Images -->
    <img src="images/hare.png" class="character hare" alt="Hare" data-char="hare">
    <img src="images/tortoise.png" class="character tortoise" alt="Tortoise" data-char="tortoise">
    <img src="images/bear.png" class="character bear" alt="Bear" data-char="bear">
    <img src="images/squirrel.png" class="character squirrel" alt="Squirrel" data-char="squirrel">
    <img src="images/bird1.png" class="character bird1" alt="Bird 1" data-char="bird1">
    <img src="images/bird2.png" class="character bird2" alt="Bird 2" data-char="bird2">
  </div>

  <!-- Firebase and Logic Scripts -->
  <script type="module">
    const API_BASE = "https://<your-function-app>.azurewebsites.net/api"; // change this
    
    // Get sessionId from URL (?session=abc123) or localStorage
    const qs = new URLSearchParams(window.location.search);
    const sessionId = qs.get("session") || localStorage.getItem("sessionCode") || null;
    
    async function validateSession() {
    if (!sessionId) {
      // No session at all → redirect immediately
      window.location.href = "sessions.html";
      return;
    }
    
    try {
      const res = await fetch(`${API_BASE}/sessions/${sessionId}`);
      if (res.status === 404) {
        // Not found in Cosmos → redirect
        window.location.href = "sessions.html";
        return;
      }
      if (!res.ok) {
        throw new Error(`API error: ${res.status}`);
      }
    
      // If found, continue loading index page normally
      console.log("Session found:", await res.json());
    
    } catch (err) {
      console.error("Session check failed:", err);
      // Fail-safe → redirect
      window.location.href = "sessions.html";
    }
    }
    
    // Run the check right away
    validateSession();
    </script>
  <script type="module" src="js/azure-api.js"></script>
  <script type="module" src="sprite-select.js"></script>
</body>
</html>
